# thcrap-steam-proton-wrapper
## Introduction
A wrapper script for launching the official Touhou games on Steam with the [Touhou Community Reliant Automatic Patcher](https://www.thpatch.net/) (thcrap), and optionally the [Vsync patch](https://en.touhouwiki.net/wiki/Game_Tools_and_Modifications#Vsync_Patches) (vpatch), from the Steam client using [Proton](<https://en.wikipedia.org/wiki/Proton_(software)>) on GNU/Linux.

This script works by taking the command Steam would normally run to launch the game, altering it to include the patch loader, and then running it.

This should allow for all the patched games to be integrated seamlessly to the Steam client on Linux.

### Rationale

On Windows, when launching a game bought on Steam with thcrap, Steam will be able to detect and automatically wrap it, so integration will work fine.

On Linux, this isn't the case. Due to the compatibility layer used to run the games, when launching them from anywhere other than the Steam client itself, Steam will be unable to detect that. This means that, while using thcrap, Steam integration won't be available, your playtime won't be tracked, and your friends won't be able to see that you are playing weird indie Japanese shmups.

So, in order to play the games with patches, and keep Steam integration, we need a workaround.

## How to use
[Here's a video tutorial](https://www.youtube.com/watch?v=gyC_EWNWqPc) by [Maxmani](https://www.youtube.com/c/Maxmani).
1. Set-up the regular version of [thcrap](https://www.thpatch.net/wiki/Touhou_Patch_Center:Download) (**not** the pre-packaged).
2. Download the script, put it under `/usr/local/bin/`, and mark it as executable:

       curl -O https://raw.githubusercontent.com/tactikauan/thcrap-steam-proton-wrapper/master/thcrap_proton
       mv thcrap_proton /usr/local/bin
       chmod +x /usr/local/bin/thcrap_proton

3. Edit the script:
- Change `THCRAP_FOLDER` to where is located your thcrap installation.
- Optionally, change the default config loaded by thcrap in `THCRAP_CONFIG`. This can be set individually for each game, as we'll see next.

4. Go to your Steam library -> right click the game -> Properties -> and edit the launch options to:

       thcrap_proton -e "%command%"
        
   This is the base command, which will run the game with the default config specified in the script.

   To enable vpatch for that specific game, add the `-v` flag.

   To override the config loaded by thcrap for that specific game, use the `-c` flag.
   
   So, if I wanted to run the game with vpatch and Brazilian Portuguese translations, the command would look like this:
       
       thcrap_proton -e "%command%" -v -c pt-br.js

   If you want to use any environment variables in your launch options, just put them at the very beginning of the line (note that when using thcrap, there's no need to set the LANG variable).

5. Run the game, and when the thcrap loader window shows up, click on 'Settings and logs' and uncheck 'Keep the updater running in background', so Steam can correctly detect when the game is closed.

   And thats it!

## Advanced
### Debugging
To have a look at the command generated by this script, run Steam through the command line.

To get a copy of the original startup command run by Steam, change the launch options to something like this:

    echo "%command%" > /tmp/command.txt

